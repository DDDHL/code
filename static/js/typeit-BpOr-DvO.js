var t,e,s,i,n,r,a,o,l,h,u,c,d,f,p,m,y,w,g,b,S,v,P,T,k,E,W,C,q,N,L,D,M,I,x,A,$,O,H,z,F,R,B,_,j,V,Q,J,U,X=Object.defineProperty,G=(t,e,s)=>(((t,e,s)=>{e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),K=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},Y=(t,e,s)=>(K(t,e,"read from private field"),s?s.call(t):e.get(t)),Z=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},tt=(t,e,s)=>(K(t,e,"access private method"),s);const et=t=>Array.isArray(t),st=t=>et(t)?t:[t];const it="data-typeit-id",nt="ti-cursor",rt={started:!1,completed:!1,frozen:!1,destroyed:!1},at={breakLines:!0,cursor:{autoPause:!0,autoPauseDelay:500,animation:{frames:[0,0,1].map((t=>({opacity:t}))),options:{iterations:1/0,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},ot=`[${it}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`,lt=t=>document.createElement(t),ht=t=>document.createTextNode(t),ut=(t,e="")=>{let s=lt("style");s.id=e,s.appendChild(ht(t)),document.head.appendChild(s)},ct=t=>(et(t)||(t=[t/2,t/2]),t),dt=(t,e)=>Math.abs(Math.random()*(t+e-(t-e))+(t-e));let ft=t=>t/2;const pt=t=>Array.from(t);let mt=t=>([...t.childNodes].forEach((t=>{if(t.nodeValue)return[...t.nodeValue].forEach((e=>{t.parentNode.insertBefore(ht(e),t)})),void t.remove();mt(t)})),t);const yt=t=>{let e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,mt(e.body)};function wt(t,e=!1,s=!1){let i,n=t.querySelector(`.${nt}`),r=document.createTreeWalker(t,NodeFilter.SHOW_ALL,{acceptNode:t=>{var e,i;if(n&&s){if(null==(e=t.classList)?void 0:e.contains(nt))return NodeFilter.FILTER_ACCEPT;if(n.contains(t))return NodeFilter.FILTER_REJECT}return(null==(i=t.classList)?void 0:i.contains(nt))?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),a=[];for(;i=r.nextNode();)i.originalParent||(i.originalParent=i.parentNode),a.push(i);return e?a.reverse():a}function gt(t,e=!0){return e?wt(yt(t)):pt(t).map(ht)}const bt=t=>Number.isInteger(t),St=({queueItems:t,selector:e,cursorPosition:s,to:i})=>{if(bt(e))return-1*e;let n=new RegExp("END","i").test(i),r=e?[...t].reverse().findIndex((({char:t})=>{let s=t.parentElement,i=s.matches(e);return!(!n||!i)||i&&s.firstChild.isSameNode(t)})):-1;return r<0&&(r=n?0:t.length-1),r-s+(n?0:1)},vt=(t,e)=>new Array(e).fill(t);let Pt=t=>new Promise((e=>{requestAnimationFrame((async()=>{e(await t())}))})),Tt=t=>null==t?void 0:t.getAnimations().find((e=>e.id===t.dataset.tiAnimationId)),kt=({cursor:t,frames:e,options:s})=>{let i=t.animate(e,s);return i.pause(),i.id=t.dataset.tiAnimationId,Pt((()=>{Pt((()=>{i.play()}))})),i},Et=t=>{var e;return null==(e=t.func)?void 0:e.call(null)},Wt=async({index:t,queueItems:e,wait:s,cursor:i,cursorOptions:n})=>{let r=e[t][1],a=[],o=t,l=r,h=()=>l&&!l.delay,u=r.shouldPauseCursor()&&n.autoPause;for(;h();)a.push(l),h()&&o++,l=e[o]?e[o][1]:null;if(a.length)return await Pt((async()=>{for(let t of a)await Et(t)})),o-1;let c,d=Tt(i);return d&&(c={...d.effect.getComputedTiming(),delay:u?n.autoPauseDelay:0}),await s((async()=>{d&&u&&d.cancel(),await Pt((()=>{Et(r)}))}),r.delay),await(({cursor:t,options:e,cursorOptions:s})=>{if(!t||!s)return;let i,n=Tt(t);n&&(e.delay=n.effect.getComputedTiming().delay,i=n.currentTime,n.cancel());let r=kt({cursor:t,frames:s.animation.frames,options:e});return i&&(r.currentTime=i),r})({cursor:i,options:c,cursorOptions:n}),t};const Ct=t=>"value"in t;let qt=t=>"function"==typeof t?t():t,Nt=(t,e=document,s=!1)=>e["querySelector"+(s?"All":"")](t);const Lt=(t,e)=>Object.assign({},t,e);let Dt={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"};class Mt{constructor(e,i={}){var r;Z(this,t),Z(this,s),Z(this,n),Z(this,a),Z(this,l),Z(this,u),Z(this,d),Z(this,p),Z(this,y),Z(this,g),Z(this,S),Z(this,P),Z(this,k),Z(this,C),Z(this,N),Z(this,D),Z(this,I),Z(this,A),Z(this,O),Z(this,z),Z(this,R),Z(this,_),Z(this,V),Z(this,J),G(this,"element"),G(this,"timeouts"),G(this,"cursorPosition"),G(this,"predictedCursorPosition"),G(this,"statuses",{started:!1,completed:!1,frozen:!1,destroyed:!1}),G(this,"opts"),G(this,"id"),G(this,"queue"),G(this,"cursor"),G(this,"unfreeze",(()=>{})),G(this,"is",(function(t){return this.statuses[t]})),Z(this,W,(t=>{t.cursor=(t=>{var e,s;if("object"==typeof t){let i={},{frames:n,options:r}=at.cursor.animation;return i.animation=t.animation||{},i.animation.frames=(null==(e=t.animation)?void 0:e.frames)||n,i.animation.options=Lt(r,(null==(s=t.animation)?void 0:s.options)||{}),i.autoPause=t.autoPause??at.cursor.autoPause,i.autoPauseDelay=t.autoPauseDelay||at.cursor.autoPauseDelay,i}return!0===t?at.cursor:t})(t.cursor??at.cursor),this.opts.strings=tt(this,C,q).call(this,st(this.opts.strings)),this.opts=Lt(this.opts,{html:!Y(this,_,j)&&this.opts.html,nextStringDelay:ct(this.opts.nextStringDelay),loopDelay:ct(this.opts.loopDelay)})})),this.opts=Lt(at,i),this.element="string"==typeof(r=e)?Nt(r):r,this.timeouts=[],this.cursorPosition=0,this.unfreeze=()=>{},this.predictedCursorPosition=null,this.statuses=Lt({},rt),this.id=Math.random().toString().substring(2,9),this.queue=function(t){let e=function(t){return st(t).forEach((t=>{var e;return n.set(Symbol(null==(e=t.char)?void 0:e.innerText),s({...t}))})),this},s=t=>(t.shouldPauseCursor=function(){return Boolean(this.typeable||this.cursorable||this.deletable)},t),i=()=>Array.from(n.values()),n=new Map;return e(t),{add:e,set:function(t,e){let i=[...n.keys()];n.set(i[t],s(e))},wipe:function(){n=new Map,e(t)},done:(t,e=!1)=>e?n.delete(t):n.get(t).done=!0,reset:function(){n.forEach((t=>delete t.done))},destroy:t=>n.delete(t),getItems:(t=!1)=>t?i():i().filter((t=>!t.done)),getQueue:()=>n,getTypeable:()=>i().filter((t=>t.typeable))}}([{delay:this.opts.startDelay}]),Y(this,W).call(this,i),this.cursor=tt(this,N,L).call(this),this.element.dataset.typeitId=this.id,ut(ot),this.opts.strings.length&&tt(this,k,E).call(this)}go(){return this.statuses.started?this:(tt(this,d,f).call(this),this.opts.waitUntilVisible?(t=this.element,e=tt(this,s,i).bind(this),new IntersectionObserver(((s,i)=>{s.forEach((s=>{s.isIntersecting&&(e(),i.unobserve(t))}))}),{threshold:1}).observe(t),this):(tt(this,s,i).call(this),this));var t,e}destroy(t=!0){this.timeouts=(this.timeouts.forEach(clearTimeout),[]),qt(t)&&this.cursor&&tt(this,O,H).call(this,this.cursor),this.statuses.destroyed=!0}reset(t){!this.is("destroyed")&&this.destroy(),t?(this.queue.wipe(),t(this)):this.queue.reset(),this.cursorPosition=0;for(let e in this.statuses)this.statuses[e]=!1;return this.element[tt(this,p,m).call(this)?"value":"innerHTML"]="",this}type(t,e={}){t=qt(t);let{instant:s}=e,i=tt(this,S,v).call(this,e),n=gt(t,this.opts.html).map((t=>{return{func:()=>tt(this,I,x).call(this,t),char:t,delay:s||(e=t,/<(.+)>(.*?)<\/(.+)>/.test(e.outerHTML))?0:tt(this,z,F).call(this),typeable:t.nodeType===Node.TEXT_NODE};var e})),r=[i[0],{func:async()=>await this.opts.beforeString(t,this)},...n,{func:async()=>await this.opts.afterString(t,this)},i[1]];return tt(this,y,w).call(this,r,e)}break(t={}){return tt(this,y,w).call(this,{func:()=>tt(this,I,x).call(this,lt("BR")),typeable:!0},t)}move(t,e={}){t=qt(t);let s=tt(this,S,v).call(this,e),{instant:i,to:a}=e,o=St({queueItems:this.queue.getTypeable(),selector:null===t?"":t,to:a,cursorPosition:Y(this,R,B)}),l=o<0?-1:1;return this.predictedCursorPosition=Y(this,R,B)+o,tt(this,y,w).call(this,[s[0],...vt({func:()=>tt(this,n,r).call(this,l),delay:i?0:tt(this,z,F).call(this),cursorable:!0},Math.abs(o)),s[1]],e)}exec(t,e={}){let s=tt(this,S,v).call(this,e);return tt(this,y,w).call(this,[s[0],{func:()=>t(this)},s[1]],e)}options(t,e={}){return t=qt(t),tt(this,P,T).call(this,t),tt(this,y,w).call(this,{},e)}pause(t,e={}){return tt(this,y,w).call(this,{delay:qt(t)},e)}delete(t=null,e={}){t=qt(t);let s=tt(this,S,v).call(this,e),i=t,{instant:n,to:r}=e,a=this.queue.getTypeable(),o=(()=>null===i?a.length:bt(i)?i:St({queueItems:a,selector:i,cursorPosition:Y(this,R,B),to:r}))();return tt(this,y,w).call(this,[s[0],...vt({func:tt(this,A,$).bind(this),delay:n?0:tt(this,z,F).call(this,1),deletable:!0},o),s[1]],e)}freeze(){this.statuses.frozen=!0}flush(t=(()=>{})){return tt(this,d,f).call(this),tt(this,s,i).call(this,!1).then(t),this}getQueue(){return this.queue}getOptions(){return this.opts}updateOptions(t){return tt(this,P,T).call(this,t)}getElement(){return this.element}empty(s={}){return tt(this,y,w).call(this,{func:tt(this,t,e).bind(this)},s)}}t=new WeakSet,e=async function(){tt(this,p,m).call(this)?this.element.value="":Y(this,J,U).forEach(tt(this,O,H).bind(this))},s=new WeakSet,i=async function(t=!0){this.statuses.started=!0;let e=e=>{this.queue.done(e,!t)};try{let n=[...this.queue.getQueue()];for(let t=0;t<n.length;t++){let[s,i]=n[t];if(!i.done){if(!i.deletable||i.deletable&&Y(this,J,U).length){let s=await tt(this,l,h).call(this,t,n);Array(s-t).fill(t+1).map(((t,e)=>t+e)).forEach((t=>{let[s]=n[t];e(s)})),t=s}e(s)}}if(!t)return this;if(this.statuses.completed=!0,await this.opts.afterComplete(this),!this.opts.loop)throw"";let r=this.opts.loopDelay;tt(this,u,c).call(this,(async()=>{await tt(this,a,o).call(this,r[0]),tt(this,s,i).call(this)}),r[1])}catch(n){}return this},n=new WeakSet,r=async function(t){var e,s,i;this.cursorPosition=(e=t,s=this.cursorPosition,i=Y(this,J,U),Math.min(Math.max(s+e,0),i.length)),((t,e,s)=>{let i=e[s-1],n=Nt(`.${nt}`,t);(t=(null==i?void 0:i.parentNode)||t).insertBefore(n,i||null)})(this.element,Y(this,J,U),this.cursorPosition)},a=new WeakSet,o=async function(t){let e=Y(this,R,B);e&&await tt(this,n,r).call(this,{value:e});let s=Y(this,J,U).map((t=>[Symbol(),{func:tt(this,A,$).bind(this),delay:tt(this,z,F).call(this,1),deletable:!0,shouldPauseCursor:()=>!0}]));for(let i=0;i<s.length;i++)await tt(this,l,h).call(this,i,s);this.queue.reset(),this.queue.set(0,{delay:t})},l=new WeakSet,h=function(t,e){return Wt({index:t,queueItems:e,wait:tt(this,u,c).bind(this),cursor:this.cursor,cursorOptions:this.opts.cursor})},u=new WeakSet,c=async function(t,e,s=!1){this.statuses.frozen&&await new Promise((t=>{this.unfreeze=()=>{this.statuses.frozen=!1,t()}})),s||await this.opts.beforeStep(this),await((t,e,s)=>new Promise((i=>{s.push(setTimeout((async()=>{await t(),i()}),e||0))})))(t,e,this.timeouts),s||await this.opts.afterStep(this)},d=new WeakSet,f=async function(){if(!tt(this,p,m).call(this)&&this.cursor&&this.element.appendChild(this.cursor),Y(this,V,Q)){((t,e)=>{let s=`[${it}='${t}'] .${nt}`,i=getComputedStyle(e),n=Object.entries(Dt).reduce(((t,[e,s])=>`${t} ${e}: var(--ti-cursor-${e}, ${s||i[e]});`),"");ut(`${s} { display: inline-block; width: 0; ${n} }`,t)})(this.id,this.element),this.cursor.dataset.tiAnimationId=this.id;let{animation:t}=this.opts.cursor,{frames:e,options:s}=t;kt({frames:e,cursor:this.cursor,options:{duration:this.opts.cursorSpeed,...s}})}},p=new WeakSet,m=function(){return Ct(this.element)},y=new WeakSet,w=function(t,e){return this.queue.add(t),tt(this,g,b).call(this,e),this},g=new WeakSet,b=function(t={}){let e=t.delay;e&&this.queue.add({delay:e})},S=new WeakSet,v=function(t={}){return[{func:()=>tt(this,P,T).call(this,t)},{func:()=>tt(this,P,T).call(this,this.opts)}]},P=new WeakSet,T=async function(t){this.opts=Lt(this.opts,t)},k=new WeakSet,E=function(){let t=this.opts.strings.filter((t=>!!t));t.forEach(((e,s)=>{if(this.type(e),s+1===t.length)return;let i=this.opts.breakLines?[{func:()=>tt(this,I,x).call(this,lt("BR")),typeable:!0}]:vt({func:tt(this,A,$).bind(this),delay:tt(this,z,F).call(this,1)},this.queue.getTypeable().length);tt(this,D,M).call(this,i)}))},W=new WeakMap,C=new WeakSet,q=function(t){let e=this.element.innerHTML;return e?(this.element.innerHTML="",this.opts.startDelete?(this.element.innerHTML=e,mt(this.element),tt(this,D,M).call(this,vt({func:tt(this,A,$).bind(this),delay:tt(this,z,F).call(this,1),deletable:!0},Y(this,J,U).length)),t):(s=e,s.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/)).concat(t)):t;var s},N=new WeakSet,L=function(){if(Y(this,_,j))return null;let t=lt("span");return t.className=nt,Y(this,V,Q)?(t.innerHTML=yt(this.opts.cursorChar).innerHTML,t):(t.style.visibility="hidden",t)},D=new WeakSet,M=function(t){let e=this.opts.nextStringDelay;this.queue.add([{delay:e[0]},...t,{delay:e[1]}])},I=new WeakSet,x=function(t){((t,e)=>{if(Ct(t))return void(t.value=`${t.value}${e.textContent}`);e.innerHTML="";let s=(i=e.originalParent,/body/i.test(null==i?void 0:i.tagName)?t:e.originalParent||t);var i;s.insertBefore(e,Nt("."+nt,s)||null)})(this.element,t)},A=new WeakSet,$=function(){Y(this,J,U).length&&(Y(this,_,j)?this.element.value=this.element.value.slice(0,-1):tt(this,O,H).call(this,Y(this,J,U)[this.cursorPosition]))},O=new WeakSet,H=function(t){((t,e)=>{if(!t)return;let s=t.parentNode;(s.childNodes.length>1||s.isSameNode(e)?t:s).remove()})(t,this.element)},z=new WeakSet,F=function(t=0){return function(t){let{speed:e,deleteSpeed:s,lifeLike:i}=t;return s=null!==s?s:e/3,i?[dt(e,ft(e)),dt(s,ft(s))]:[e,s]}(this.opts)[t]},R=new WeakSet,B=function(){return this.predictedCursorPosition??this.cursorPosition},_=new WeakSet,j=function(){return Ct(this.element)},V=new WeakSet,Q=function(){return!!this.opts.cursor&&!Y(this,_,j)},J=new WeakSet,U=function(){return t=this.element,Ct(t)?pt(t.value):wt(t,!0).filter((t=>!(t.childNodes.length>0)));var t};export{Mt as T};
